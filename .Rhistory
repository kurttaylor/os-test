plot2$P_value <- signif(plot2$P_value, digits = 2)
plot2$estimate <- paste(plot2$estimate, "GRS P =", sep = " - ")
plot2$estimate <- paste(plot2$estimate, plot2$P_value, sep = "")
plot2$estimate <- paste(plot2$estimate, "*R^2~ =", sep = ", ")
# separate data to put plots side by side
plot1 <- main_nmr_results
plot2 <- forestdf
# change labels of metabs to include super pathway
plot1$raw.label <- paste(plot1$raw.label, plot1$class, sep = " - ")
plot2$raw.label <- paste(plot2$raw.label, plot2$class, sep = " - ")
# change the order of super pathway
plot1$raw.label <- factor(plot1$raw.label, levels = plot1$raw.label[order(plot1$class)])
plot1$raw.label <- factor(plot1$raw.label, levels=rev(levels(plot1$raw.label)))
plot1$class <- trimws(plot1$class)
table(plot1$class)
plot2$raw.label <- factor(plot2$raw.label, levels = plot2$raw.label[order(plot2$class)])
plot2$raw.label <- factor(plot2$raw.label, levels=rev(levels(plot2$raw.label)))
plot2$class <- trimws(plot2$class)
table(plot2$class)
# ADD P VALUE AND R SQUARED TO MR PLOT
mr_vals <- read.xlsx("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/genetic_associations/bib_genetic_analyses/mr_relevance_results_bib.xlsx")
mr_vals <- mr_vals %>% dplyr::select(y, P_value, r_squared_perc) %>%
dplyr::rename(metabolite = y)
plot2 <- merge(plot2, mr_vals, all.x = T)
plot2$P_value <- signif(plot2$P_value, digits = 2)
plot2$estimate <- paste(plot2$estimate, "GRS P =", sep = " - ")
plot2$estimate <- paste(plot2$estimate, plot2$P_value, sep = "")
plot2$estimate <- paste(plot2$estimate, "*R^2~=", sep = ", ")
plot1 <- main_nmr_results
plot2 <- forestdf
# change labels of metabs to include super pathway
plot1$raw.label <- paste(plot1$raw.label, plot1$class, sep = " - ")
plot2$raw.label <- paste(plot2$raw.label, plot2$class, sep = " - ")
# change the order of super pathway
plot1$raw.label <- factor(plot1$raw.label, levels = plot1$raw.label[order(plot1$class)])
plot1$raw.label <- factor(plot1$raw.label, levels=rev(levels(plot1$raw.label)))
plot1$class <- trimws(plot1$class)
table(plot1$class)
plot2$raw.label <- factor(plot2$raw.label, levels = plot2$raw.label[order(plot2$class)])
plot2$raw.label <- factor(plot2$raw.label, levels=rev(levels(plot2$raw.label)))
plot2$class <- trimws(plot2$class)
table(plot2$class)
# ADD P VALUE AND R SQUARED TO MR PLOT
mr_vals <- read.xlsx("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/genetic_associations/bib_genetic_analyses/mr_relevance_results_bib.xlsx")
mr_vals <- mr_vals %>% dplyr::select(y, P_value, r_squared_perc) %>%
dplyr::rename(metabolite = y)
plot2 <- merge(plot2, mr_vals, all.x = T)
plot2$P_value <- signif(plot2$P_value, digits = 2)
plot2$estimate <- paste(plot2$estimate, "GRS P =", sep = " - ")
plot2$estimate <- paste(plot2$estimate, plot2$P_value, sep = "")
plot2$estimate <- paste(plot2$estimate, "R² =", sep = ", ")
plot2$estimate <- paste(plot2$estimate, plot2$r_squared_perc, sep = "")
# separate data to put plots side by side
plot1 <- main_nmr_results
plot2 <- forestdf
# change labels of metabs to include super pathway
plot1$raw.label <- paste(plot1$raw.label, plot1$class, sep = " - ")
plot2$raw.label <- paste(plot2$raw.label, plot2$class, sep = " - ")
# change the order of super pathway
plot1$raw.label <- factor(plot1$raw.label, levels = plot1$raw.label[order(plot1$class)])
plot1$raw.label <- factor(plot1$raw.label, levels=rev(levels(plot1$raw.label)))
plot1$class <- trimws(plot1$class)
table(plot1$class)
plot2$raw.label <- factor(plot2$raw.label, levels = plot2$raw.label[order(plot2$class)])
plot2$raw.label <- factor(plot2$raw.label, levels=rev(levels(plot2$raw.label)))
plot2$class <- trimws(plot2$class)
table(plot2$class)
# ADD P VALUE AND R SQUARED TO MR PLOT
mr_vals <- read.xlsx("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/genetic_associations/bib_genetic_analyses/mr_relevance_results_bib.xlsx")
mr_vals <- mr_vals %>% dplyr::select(y, P_value, r_squared_perc) %>%
dplyr::rename(metabolite = y)
plot2 <- merge(plot2, mr_vals, all.x = T)
plot2$P_value <- signif(plot2$P_value, digits = 2)
plot2$estimate <- paste(plot2$estimate, "GRS P =", sep = " - ")
plot2$estimate <- paste(plot2$estimate, plot2$P_value, sep = "")
plot2$estimate <- paste(plot2$estimate, "R² =", sep = ", ")
plot2$estimate <- paste(plot2$estimate, plot2$r_squared_perc, sep = "% ")
# separate data to put plots side by side
plot1 <- main_nmr_results
plot2 <- forestdf
# change labels of metabs to include super pathway
plot1$raw.label <- paste(plot1$raw.label, plot1$class, sep = " - ")
plot2$raw.label <- paste(plot2$raw.label, plot2$class, sep = " - ")
# change the order of super pathway
plot1$raw.label <- factor(plot1$raw.label, levels = plot1$raw.label[order(plot1$class)])
plot1$raw.label <- factor(plot1$raw.label, levels=rev(levels(plot1$raw.label)))
plot1$class <- trimws(plot1$class)
table(plot1$class)
plot2$raw.label <- factor(plot2$raw.label, levels = plot2$raw.label[order(plot2$class)])
plot2$raw.label <- factor(plot2$raw.label, levels=rev(levels(plot2$raw.label)))
plot2$class <- trimws(plot2$class)
table(plot2$class)
# ADD P VALUE AND R SQUARED TO MR PLOT
mr_vals <- read.xlsx("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/genetic_associations/bib_genetic_analyses/mr_relevance_results_bib.xlsx")
mr_vals <- mr_vals %>% dplyr::select(y, P_value, r_squared_perc) %>%
dplyr::rename(metabolite = y)
plot2 <- merge(plot2, mr_vals, all.x = T)
plot2$P_value <- signif(plot2$P_value, digits = 2)
plot2$estimate <- paste(plot2$estimate, "GRS P =", sep = " - ")
plot2$estimate <- paste(plot2$estimate, plot2$P_value, sep = "")
plot2$estimate <- paste(plot2$estimate, "R² =", sep = ", ")
plot2$estimate <- paste(plot2$estimate, plot2$r_squared_perc, sep = " ")
plot2$estimate <- paste(plot2$estimate, "%", sep = "")
# separate data to put plots side by side
plot1 <- main_nmr_results
plot2 <- forestdf
# change labels of metabs to include super pathway
plot1$raw.label <- paste(plot1$raw.label, plot1$class, sep = " - ")
plot2$raw.label <- paste(plot2$raw.label, plot2$class, sep = " - ")
# change the order of super pathway
plot1$raw.label <- factor(plot1$raw.label, levels = plot1$raw.label[order(plot1$class)])
plot1$raw.label <- factor(plot1$raw.label, levels=rev(levels(plot1$raw.label)))
plot1$class <- trimws(plot1$class)
table(plot1$class)
plot2$raw.label <- factor(plot2$raw.label, levels = plot2$raw.label[order(plot2$class)])
plot2$raw.label <- factor(plot2$raw.label, levels=rev(levels(plot2$raw.label)))
plot2$class <- trimws(plot2$class)
table(plot2$class)
# ADD P VALUE AND R SQUARED TO MR PLOT
mr_vals <- read.xlsx("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/genetic_associations/bib_genetic_analyses/mr_relevance_results_bib.xlsx")
mr_vals <- mr_vals %>% dplyr::select(y, P_value, r_squared_perc) %>%
dplyr::rename(metabolite = y)
plot2 <- merge(plot2, mr_vals, all.x = T)
plot2$P_value <- signif(plot2$P_value, digits = 2)
plot2$estimate <- paste(plot2$estimate, "GRS P =", sep = " - ")
plot2$estimate <- paste(plot2$estimate, plot2$P_value, sep = "")
plot2$estimate <- paste(plot2$estimate, "R² =", sep = ", ")
plot2$estimate <- paste(plot2$estimate, plot2$r_squared_perc, sep = " ")
plot2$estimate <- paste(plot2$estimate, "%", sep = "")
# change the order of super pathway
#
# plot1$class <- factor(plot1$class, levels = c("Unnamed Molecule", "Energy", "Cofactors and Vitamins", "Lipid", "Amino Acid"))
# plot1$biochemical <- factor(plot1$biochemical, levels = plot1$biochemical[order(plot1$class)])
#
# plot2$class <- factor(plot2$class, levels = c("Unnamed Molecule", "Energy", "Cofactors and Vitamins", "Lipid", "Amino Acid"))
# plot2$biochemical <- factor(plot2$biochemical, levels = plot2$biochemical[order(plot2$class)])
### ADD ASTERIX's TO DENOTE SPECIFIC GRS's
# plot2$specific <- 1
# plot2$specific[c(5,9,2,27,1,15)] <- 0
#
# plot2$specific <- as.factor(plot2$specific)
# MAKE FOREST PLOT --------------------------------------------------------
## plot 1
p <- ggplot(plot1, aes(x = OR, y = raw.label, xmin = CI_LOW, xmax = CI_HIGH))+
geom_pointrange(shape=22, aes(fill=class, colour=class), show.legend = FALSE) +
scale_fill_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
scale_color_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
geom_vline(xintercept = 1, linetype=3) +
xlab("\n\nAdjusted OR (95% CI) of CHD per SD change in metabolic trait") +
ylab("Metabolic trait and subclass\n\n") +
theme_bw() +
#scale_y_discrete(limits = rev(labels))+
scale_x_log10(limits = c(0.35, 2.7),
breaks = c(0.5, 1, 2, 2.7),
labels=c("0.5", "1", "2", ""),
#breaks = NULL,
expand = c(0,0)) +
#geom_text(aes(x=15, label=paste("  ",  estimate,"  ",class, sep='   ')), size = 2)
geom_text(aes(x=2, label=paste("  ",  estimate)), size = 3.8)
# geom_text(aes(x=4.8, label=paste("  ",  class)), size = 2.5)
p <- p + removeGrid(x = TRUE, y = FALSE) +
theme(axis.title.x=element_text(size=18,face="bold"),  axis.title.y=element_text(size=18,face="bold"),
axis.text.y = element_text(size = 13), axis.text.x = element_text(size = 15, face = "bold"))
## plot 2
p2 <- ggplot(plot2, aes(x = OR, y = raw.label, xmin = CI_low, xmax = CI_high))+
geom_pointrange(shape=22, aes(fill=class, colour=class), show.legend = FALSE) +
scale_fill_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
scale_color_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
geom_vline(xintercept = 1, linetype=3) +
xlab("\n\nOR (95% CI) of CHD per SD change in GRS") +
theme_bw() +
#scale_y_discrete(limits = rev(labels))+
scale_x_log10(limits = c(0.35, 2.5),
breaks = c(0.5, 1, 2, 2.5),
labels=c("0.5", "1", "2", ""),
#breaks = NULL,
expand = c(0,0)) +
#geom_text(aes(x=15, label=paste("  ",  estimate,"  ",class, sep='   ')), size = 2)
geom_text(aes(x=2, label=paste("  ",  estimate)), size = 3.8)
# geom_text(aes(x=3, label=paste("  ",  class)), size = 2.5)
p2 <- p2 + removeGrid(x = TRUE, y = FALSE) + theme(axis.title.x=element_text(size=18,face="bold"), axis.title.y = element_blank(),
axis.text.y = element_blank(), axis.text.x = element_text(size = 15, face = "bold"))
## combine and save figure
plot_row <- plot_grid(p, p2,
labels = c("A: Main multivariable regression results", "B: Mendelian randomization results"),
label_size = 18,
label_fontface = "bold",
hjust = c(0, 0),
nrow = 1,
scale = 0.9,
rel_widths = c(1.9,1)
)
# now add the title
title <- ggdraw() +
draw_label(
"Exploring directional consistency between phenotype (conventional multivariable regression) and genotype (Mendelian randomization) associations with metabolic traits",
fontface = 'bold',
size = 20,
x = 0,
hjust = 0
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
pdf("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/figures/grs_forests/forest_truncated_mr_compare.pdf",
height = 18, width = 24)
plot_grid(
title, plot_row,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.05, 1)
)
dev.off()
## HIGH RES
#
# tiff("/Users/kt17109/OneDrive - University of Bristol/Main Project/MassSpec_metabolomics_project/Figures/Forests/forest_main_mr_compare.tiff",
#      units="in", height=13, width=22, res=600)
# plot_grid(
#   title, plot_row,
#   ncol = 1,
#   # rel_heights values control vertical title margins
#   rel_heights = c(0.05, 1)
# )
# dev.off()
p <- ggplot(plot1, aes(x = OR, y = raw.label, xmin = CI_LOW, xmax = CI_HIGH))+
geom_pointrange(shape=22, aes(fill=class, colour=class), show.legend = FALSE) +
scale_fill_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
scale_color_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
geom_vline(xintercept = 1, linetype=3) +
xlab("\n\nAdjusted OR (95% CI) of CHD per SD change in metabolic trait") +
ylab("Metabolic trait and subclass\n\n") +
theme_bw() +
#scale_y_discrete(limits = rev(labels))+
scale_x_log10(limits = c(0.35, 2.7),
breaks = c(0.5, 1, 2, 2.7),
labels=c("0.5", "1", "2", ""),
#breaks = NULL,
expand = c(0,0)) +
#geom_text(aes(x=15, label=paste("  ",  estimate,"  ",class, sep='   ')), size = 2)
geom_text(aes(x=2, label=paste("  ",  estimate)), size = 3.8)
# geom_text(aes(x=4.8, label=paste("  ",  class)), size = 2.5)
p <- p + removeGrid(x = TRUE, y = FALSE) +
theme(axis.title.x=element_text(size=18,face="bold"),  axis.title.y=element_text(size=18,face="bold"),
axis.text.y = element_text(size = 13), axis.text.x = element_text(size = 15, face = "bold"))
## plot 2
p2 <- ggplot(plot2, aes(x = OR, y = raw.label, xmin = CI_low, xmax = CI_high))+
geom_pointrange(shape=22, aes(fill=class, colour=class), show.legend = FALSE) +
scale_fill_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
scale_color_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
geom_vline(xintercept = 1, linetype=3) +
xlab("\n\nOR (95% CI) of CHD per SD change in GRS") +
theme_bw() +
#scale_y_discrete(limits = rev(labels))+
scale_x_log10(limits = c(0.35, 2.8),
breaks = c(0.5, 1, 2, 2.8),
labels=c("0.5", "1", "2", ""),
#breaks = NULL,
expand = c(0,0)) +
#geom_text(aes(x=15, label=paste("  ",  estimate,"  ",class, sep='   ')), size = 2)
geom_text(aes(x=2, label=paste("  ",  estimate)), size = 3.8)
# geom_text(aes(x=3, label=paste("  ",  class)), size = 2.5)
p2 <- p2 + removeGrid(x = TRUE, y = FALSE) + theme(axis.title.x=element_text(size=18,face="bold"), axis.title.y = element_blank(),
axis.text.y = element_blank(), axis.text.x = element_text(size = 15, face = "bold"))
## combine and save figure
plot_row <- plot_grid(p, p2,
labels = c("A: Main multivariable regression results", "B: Mendelian randomization results"),
label_size = 18,
label_fontface = "bold",
hjust = c(0, 0),
nrow = 1,
scale = 0.9,
rel_widths = c(1.9,1)
)
# now add the title
title <- ggdraw() +
draw_label(
"Exploring directional consistency between phenotype (conventional multivariable regression) and genotype (Mendelian randomization) associations with metabolic traits",
fontface = 'bold',
size = 20,
x = 0,
hjust = 0
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
pdf("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/figures/grs_forests/forest_truncated_mr_compare.pdf",
height = 18, width = 24)
plot_grid(
title, plot_row,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.05, 1)
)
dev.off()
## HIGH RES
#
# tiff("/Users/kt17109/OneDrive - University of Bristol/Main Project/MassSpec_metabolomics_project/Figures/Forests/forest_main_mr_compare.tiff",
#      units="in", height=13, width=22, res=600)
# plot_grid(
#   title, plot_row,
#   ncol = 1,
#   # rel_heights values control vertical title margins
#   rel_heights = c(0.05, 1)
# )
# dev.off()
rm(list = ls())
#------------------------------------------------------------------------------------
# PLOT 1 - FOREST PLOT MAIN ANALYSES ---------------------------------------------------------
#------------------------------------------------------------------------------------
# read in results from adjusted logistic regression model
main_results <- read.xlsx("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/figures/grs_forests/files/fdf_all_metabs.xlsx")
main_results$raw.label <- NULL
main_results$subclass <- NULL
#------------------------------------------------------------------------------------
# PLOT 2 - FOREST PLOT MR ANALYSES ---------------------------------------------------------
#------------------------------------------------------------------------------------
# read in results from adjusted logistic regression model
main_meta_results <- read.xlsx("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/genetic_associations/nmr_grs_chd_ma_results.xlsx",
sheet = 1)
main_meta_results <- main_meta_results %>% dplyr::rename(Name.in.TSV = metabolite)
# get metabolite meta info
meta <- read.xlsx("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/nmr_meta_nmr_grs.xlsx")
main_nmr_results <- merge(main_results, meta)
main_grs_results <- merge(main_meta_results, meta, all.x = T)
# NARROW DOWN TO 145 METABOLITES IN NMR AND GRS
main_nmr_results <- main_nmr_results[which(main_nmr_results$Name.in.TSV %in% main_grs_results$Name.in.TSV),]
main_grs_results <- main_grs_results[which(main_grs_results$Name.in.TSV %in% main_nmr_results$Name.in.TSV),]
# NARRROW TO TRUNCATED METABS
truncated <- read.xlsx("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/figures/labels_seventy_metabs.xlsx")
truncated$raw.label <- str_trim(truncated$raw.label)
truncated <- truncated %>% dplyr::select(metabolite)
truncated_metabs <- truncated$metabolite
# add degree of unsaturation
truncated_metabs <- c(truncated_metabs, "unsat")
main_nmr_results <- main_nmr_results[main_nmr_results$metabolite %in% truncated_metabs, ]
main_grs_results <- main_grs_results[main_grs_results$metabolite %in% truncated_metabs, ]
# MR results data prep ----------------------------------------------------
# factorize metabolite names
main_grs_results$metabolite <- as.factor(main_grs_results$metabolite)
# factorise super pathway
main_grs_results$subclass <- as.factor(main_grs_results$subclass)
forestdf <- main_grs_results
# make results (ORs and CIs) to two decimal places
forestdf[, c(5:9, 11)] <- round(forestdf[, c(5:9, 11)], digits = 2)
# make variable with OR and CIs in one cell to paste onto the plot
forestdf$estimate <- paste0(formatC(forestdf$OR, digits = 2, format = "f"), " (", formatC(forestdf$CI_low, digits = 2, format = "f"))
forestdf$estimate <- paste0(forestdf$estimate, ", ", formatC(forestdf$CI_high, digits = 2, format = "f"))
forestdf$estimate <- paste0(forestdf$estimate, ")")
# forestdf$estimate <- paste0(forestdf$estimate, " - P-int = ", formatC(forestdf$P_int, digits = 2, format = "f"))
# make data frame to paste values onto plot
fplottable <- forestdf[c("metabolite", "subclass", "estimate")]
# # keep variables and combine dataframes in fdf (final data frame) for plotting
#
# forestdf <- forestdf %>% dplyr::select(raw.label, metabolite, subclass, estimate, OR, CI_LOW, CI_HIGH)
# fdf <- full_join(forestdf, fplottable, by = c("metabolite", "subclass", "estimate"))
# change the order so that metabolites are plotted in alphabetical order of their super pathway (amino acids first)
# fdf$metabolite <- factor(fdf$metabolite, levels = fdf$metabolite[order(fdf$subclass)])
# fdf$metabolite <- factor(fdf$metabolite, levels=rev(levels(fdf$metabolite)))
forestdf$raw.label <- factor(forestdf$raw.label, levels = forestdf$raw.label[order(forestdf$subclass)])
forestdf$raw.label <- factor(forestdf$raw.label, levels=rev(levels(forestdf$raw.label)))
# PREPARE PLOTS -----------------------------------------------------------
# separate data to put plots side by side
plot1 <- main_nmr_results
plot2 <- forestdf
# change labels of metabs to include super pathway
plot1$raw.label <- paste(plot1$raw.label, plot1$class, sep = " - ")
plot2$raw.label <- paste(plot2$raw.label, plot2$class, sep = " - ")
# change the order of super pathway
plot1$raw.label <- factor(plot1$raw.label, levels = plot1$raw.label[order(plot1$class)])
plot1$raw.label <- factor(plot1$raw.label, levels=rev(levels(plot1$raw.label)))
plot1$class <- trimws(plot1$class)
table(plot1$class)
plot2$raw.label <- factor(plot2$raw.label, levels = plot2$raw.label[order(plot2$class)])
plot2$raw.label <- factor(plot2$raw.label, levels=rev(levels(plot2$raw.label)))
plot2$class <- trimws(plot2$class)
table(plot2$class)
# ADD P VALUE AND R SQUARED TO MR PLOT
# mr_vals <- read.xlsx("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/genetic_associations/bib_genetic_analyses/mr_relevance_results_bib.xlsx")
# mr_vals <- mr_vals %>% dplyr::select(y, P_value, r_squared_perc) %>%
#   dplyr::rename(metabolite = y)
# plot2 <- merge(plot2, mr_vals, all.x = T)
# plot2$P_value <- signif(plot2$P_value, digits = 2)
#
# plot2$estimate <- paste(plot2$estimate, "GRS P =", sep = " - ")
# plot2$estimate <- paste(plot2$estimate, plot2$P_value, sep = "")
# plot2$estimate <- paste(plot2$estimate, "R² =", sep = ", ")
# plot2$estimate <- paste(plot2$estimate, plot2$r_squared_perc, sep = " ")
# plot2$estimate <- paste(plot2$estimate, "%", sep = "")
# change the order of super pathway
#
# plot1$class <- factor(plot1$class, levels = c("Unnamed Molecule", "Energy", "Cofactors and Vitamins", "Lipid", "Amino Acid"))
# plot1$biochemical <- factor(plot1$biochemical, levels = plot1$biochemical[order(plot1$class)])
#
# plot2$class <- factor(plot2$class, levels = c("Unnamed Molecule", "Energy", "Cofactors and Vitamins", "Lipid", "Amino Acid"))
# plot2$biochemical <- factor(plot2$biochemical, levels = plot2$biochemical[order(plot2$class)])
### ADD ASTERIX's TO DENOTE SPECIFIC GRS's
# plot2$specific <- 1
# plot2$specific[c(5,9,2,27,1,15)] <- 0
#
# plot2$specific <- as.factor(plot2$specific)
# MAKE FOREST PLOT --------------------------------------------------------
## plot 1
p <- ggplot(plot1, aes(x = OR, y = raw.label, xmin = CI_LOW, xmax = CI_HIGH))+
geom_pointrange(shape=22, aes(fill=class, colour=class), show.legend = FALSE) +
scale_fill_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
scale_color_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
geom_vline(xintercept = 1, linetype=3) +
xlab("\n\nAdjusted OR (95% CI) of CHD per SD change in metabolic trait") +
ylab("Metabolic trait and subclass\n\n") +
theme_bw() +
#scale_y_discrete(limits = rev(labels))+
scale_x_log10(limits = c(0.35, 2.7),
breaks = c(0.5, 1, 2, 2.7),
labels=c("0.5", "1", "2", ""),
#breaks = NULL,
expand = c(0,0)) +
#geom_text(aes(x=15, label=paste("  ",  estimate,"  ",class, sep='   ')), size = 2)
geom_text(aes(x=2, label=paste("  ",  estimate)), size = 3.8)
# geom_text(aes(x=4.8, label=paste("  ",  class)), size = 2.5)
p <- p + removeGrid(x = TRUE, y = FALSE) +
theme(axis.title.x=element_text(size=18,face="bold"),  axis.title.y=element_text(size=18,face="bold"),
axis.text.y = element_text(size = 13), axis.text.x = element_text(size = 15, face = "bold"))
## plot 2
p2 <- ggplot(plot2, aes(x = OR, y = raw.label, xmin = CI_low, xmax = CI_high))+
geom_pointrange(shape=22, aes(fill=class, colour=class), show.legend = FALSE) +
scale_fill_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
scale_color_manual(values = c('black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black', 'black')) +
geom_vline(xintercept = 1, linetype=3) +
xlab("\n\nOR (95% CI) of CHD per SD change in GRS") +
theme_bw() +
#scale_y_discrete(limits = rev(labels))+
scale_x_log10(limits = c(0.35, 2.8),
breaks = c(0.5, 1, 2, 2.8),
labels=c("0.5", "1", "2", ""),
#breaks = NULL,
expand = c(0,0)) +
#geom_text(aes(x=15, label=paste("  ",  estimate,"  ",class, sep='   ')), size = 2)
geom_text(aes(x=2, label=paste("  ",  estimate)), size = 3.8)
# geom_text(aes(x=3, label=paste("  ",  class)), size = 2.5)
p2 <- p2 + removeGrid(x = TRUE, y = FALSE) + theme(axis.title.x=element_text(size=18,face="bold"), axis.title.y = element_blank(),
axis.text.y = element_blank(), axis.text.x = element_text(size = 15, face = "bold"))
## combine and save figure
plot_row <- plot_grid(p, p2,
labels = c("A: Main multivariable regression results", "B: Mendelian randomization results"),
label_size = 18,
label_fontface = "bold",
hjust = c(0, 0),
nrow = 1,
scale = 0.9,
rel_widths = c(1.9,1)
)
# now add the title
title <- ggdraw() +
draw_label(
"Exploring directional consistency between phenotype (conventional multivariable regression) and genotype (Mendelian randomization) associations with metabolic traits",
fontface = 'bold',
size = 20,
x = 0,
hjust = 0
) +
theme(
# add margin on the left of the drawing canvas,
# so title is aligned with left edge of first plot
plot.margin = margin(0, 0, 0, 0)
)
pdf("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/Results/figures/grs_forests/forest_truncated_mr_compare.pdf",
height = 18, width = 24)
plot_grid(
title, plot_row,
ncol = 1,
# rel_heights values control vertical title margins
rel_heights = c(0.05, 1)
)
dev.off()
## HIGH RES
#
# tiff("/Users/kt17109/OneDrive - University of Bristol/Main Project/MassSpec_metabolomics_project/Figures/Forests/forest_main_mr_compare.tiff",
#      units="in", height=13, width=22, res=600)
# plot_grid(
#   title, plot_row,
#   ncol = 1,
#   # rel_heights values control vertical title margins
#   rel_heights = c(0.05, 1)
# )
# dev.off()
meta <- read.xlsx("/Users/kt17109/OneDrive - University of Bristol/Main Project/NMR_metabolomics_project/nmr_meta_nmr_grs.xlsx")
View(meta)
library(readstata13)
baseline <- read.dta13("/Volumes/MRC-IEU-research/data/bib/_latest/BIB_Phenotypes/data/stata/BiB_Baseline/p1_mother_baseline_v1-14-2_BiB_CohortInfo.m_derived_info.dta")
View(baseline)
baseline <- read.dta13("/Volumes/MRC-IEU-research/data/bib/_latest/BIB_Phenotypes/data/stata/BiB_Baseline/p1_mother_baseline_v1-14-2_BiB_Baseline.base_m_survey.dta-14-2_BiB_CohortInfo.m_derived_info.dta")
baseline <- read.dta13("/Volumes/MRC-IEU-research/data/bib/_latest/BIB_Phenotypes/data/stata/BiB_Baseline/p1_mother_baseline_v1-14-2_BiB_Baseline.base_m_survey.dta")
View(baseline)
summary(baseline$vit0vitdpr)
summary(baseline$vit0othmvd)
summary(baseline$vit0othvpd)
vitd <- read.dta13("/Volumes/MRC-IEU-research/data/bib/_latest/BIB_Phenotypes/data/stata/BiB_Pregnancy/p3_preg_birth_v1-14-2_BiB_Pregnancy.pregnancy_bloods_vitd.dta")
View(vitd)
library('tidyverse')
df_input <- read_csv(
here::here("output", "input.csv"),
col_types = cols(patient_id = col_integer(),age = col_double())
)
setwd("/Users/kt17109/OneDrive - University of Bristol/ehr_postdoc/os_test/os-test")
df_input <- read_csv(
here::here("output", "input.csv"),
col_types = cols(patient_id = col_integer(),age = col_double())
)
